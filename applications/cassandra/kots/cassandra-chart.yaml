apiVersion: kots.io/v1beta2
kind: HelmChart
metadata:
  name: cassandra
spec:
  chart:
    name: cassandra
    chartVersion: 0.4.0
  helmUpgradeFlags:
    - --wait
    - --timeout
    - 600s
  values:
    replicated:
      enabled: true
    nfs-server:
      enabled: true
      persistence:
        shared:
          enabled: true
          type: emptyDir
          mountPath: repl{{ ConfigOption "nfs_share" }}
      env:
        NFS_EXPORT_0: repl{{ ConfigOption "nfs_share" }} *(rw,sync,no_subtree_check,no_root_squash)
    cassandra:
      enabled: true
      truststore_password : repl{{ ConfigOption "cassandra_truststore_password" }}
      keystore_password : repl{{ ConfigOption "cassandra_keystore_password" }}
      dbUser:
        user: repl{{ ConfigOption "cassandra_user" }}
        password: repl{{ ConfigOption "cassandra_password" }}
      tls:
        internodeEncryption: all
        clientEncryption: true
        autogenerated: true
        certificateSecret: cassandra-tls-cert
        passwordSecret: cassandra-credentials
        cert: |
          repl{{ ConfigOptionData `cassandra_tls_cert` | nindent 12 }}
        key: |
          repl{{ ConfigOptionData `cassandra_tls_key` | nindent 12 }}
        ca: |
          repl{{ ConfigOptionData `cassandra_tls_ca` | nindent 12 }}
    postgres:
      enabled: true
      embedded:
        enabled: true
      auth:
        username: repl{{ ConfigOption "postgres_user" }}
        password: repl{{ ConfigOption "postgres_password" }}
      initdb:
        database: repl{{ ConfigOption "postgres_db" }}
        owner: repl{{ ConfigOption "postgres_db_owner" }}
